<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>心动特效</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at center, #ffccd5, #ff4d6d);
    }
    canvas {
      display: block;
    }
    #msg {
      position: absolute;
      top: 20%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 8px rgba(255,0,80,0.8);
    }
  </style>
</head>
<body>
  <div id="msg">💖 给你我的心</div>
  <canvas id="canvas"></canvas>
  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let W, H;
    function resize() {
      W = canvas.width = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }
    resize();
    window.onresize = resize;

    // 爱心函数
    function heart(t, scale = 10, offsetX = W/2, offsetY = H/2) {
      let x = 16 * Math.sin(t) ** 3;
      let y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      return [offsetX + scale * x, offsetY - scale * y];
    }

    let beat = 1.0, targetBeat = 1.0;
    let heartCenter = {x: W/2, y: H/2};
    let dragging = false;

    // 粒子系统
    class Particle {
      constructor(x, y) {
        this.x = x; this.y = y;
        this.vx = (Math.random()-0.5)*6;
        this.vy = (Math.random()-0.5)*6;
        this.life = 60 + Math.random()*20;
        this.size = 3;
        this.color = `hsla(${Math.random()*60+330}, 100%, 70%, 1)`;
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.05;
        this.life--;
      }
      draw(ctx) {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
        ctx.fillStyle = this.color;
        ctx.fill();
      }
    }
    let particles = [];

    canvas.addEventListener("mousedown", e => {
      triggerExplosion(e.offsetX, e.offsetY);
      dragging = true;
    });
    canvas.addEventListener("mouseup", () => dragging = false);
    canvas.addEventListener("mousemove", e => {
      if(dragging) {
        heartCenter.x = e.offsetX;
        heartCenter.y = e.offsetY;
      }
    });

    canvas.addEventListener("touchstart", e => {
      let t = e.touches[0];
      triggerExplosion(t.clientX, t.clientY);
      dragging = true;
    });
    canvas.addEventListener("touchend", () => dragging = false);
    canvas.addEventListener("touchmove", e => {
      if(dragging) {
        let t = e.touches[0];
        heartCenter.x = t.clientX;
        heartCenter.y = t.clientY;
      }
    });

    function triggerExplosion(x, y) {
      for(let i=0; i<80; i++) {
        particles.push(new Particle(x, y));
      }
      targetBeat = 1.4;
    }

    function drawHeart(scale=12*beat) {
      ctx.beginPath();
      for(let t=0; t<=Math.PI*2; t+=0.05) {
        let [x, y] = heart(t, scale, heartCenter.x, heartCenter.y);
        if(t === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fillStyle = "#ff1c64";
      ctx.shadowColor = "#ff8cb3";
      ctx.shadowBlur = 20;
      ctx.fill();
      ctx.shadowBlur = 0;
    }

    function animate() {
      ctx.clearRect(0,0,W,H);
      beat += (targetBeat - beat) * 0.1;
      targetBeat += (1.0 - targetBeat) * 0.05;
      drawHeart();
      for(let i=particles.length-1; i>=0; i--){
        let p = particles[i];
        p.update();
        p.draw(ctx);
        if(p.life<=0) particles.splice(i,1);
      }
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
